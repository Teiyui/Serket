# encoding: shift_jis
import codecs
import sys
import os
import math

def toHiragana( str ):
    p = os.popen( "KanjiConv.exe " + str , "r" )
    hiragana = p.read()
    p.close()
    return hiragana

def toOnso( kana ):
    for n in(6,4,2):
        for k,o in kana2hiragana.items():
            if len(k)==n:   # í∑Ç¢Ç‡ÇÃÇ©ÇÁïœä∑
                kana = kana.replace( k , o )

    kana = kana.replace(" :" , ":" )
    return kana

def main():
    words =[]

    word2num = {}
    class2num = {}

    for line in codecs.open( sys.argv[1] ).readlines():
        line = line.replace("\r" , "" ).replace("\n" , "" )

        if line=="<s>" or line=="</s>":
            continue

        cls = None
        word = line

        pos = line.find("+")
        if pos != -1:
            cls = line[pos+1:]
            word = line[:pos]

#        kana = toHiragana(word)
        kana = word
        onso = toOnso( kana )
        words.append( (word,onso,cls) )

        # î≠ê∂âÒêîÇÉJÉEÉìÉg
        word2num[word] = word2num.get( word , 0 ) + 1
        class2num[cls] = class2num.get( cls , 0 ) + 1

    for word,onso,cls in words:
        if cls:
            prob = math.log( float(word2num[word]) / class2num[cls] )
            print( "%s @%lf %s\t[%s]\t%s" % ( cls , prob , word , word , onso ) )
        else:
            print( "%s\t[%s]\t%s" % ( word , word , onso ) )

    print( "<s>\t[]\tsilB" )
    print( "</s>\t[]\tsilE" )


kana2hiragana = {
"Ç§ÅJÇü" : "b a ",
"Ç§ÅJÇ°" : "b i ",
"Ç§ÅJÇ•" : "b e ",
"Ç§ÅJÇß" : "b o ",
"Ç§ÅJÇ„" : "by u ",
"Ç£ÅJ" : "b u ",
"Ç†Çü" : "a a ",
"Ç¢Ç°" : "i i ",
"Ç¢Ç•" : "i e ",
"Ç¢Ç·" : "y a ",
"Ç§Ç£" : "u: ",
"Ç¶Ç•" : "e e ",
"Ç®Çß" : "o: ",
"Ç©Çü" : "k a: ",
"Ç´Ç°" : "k i: ",
"Ç≠Ç£" : "k u: ",
"Ç≠Ç·" : "ky a ",
"Ç≠Ç„" : "ky u ",
"Ç≠ÇÂ" : "ky o ",
"ÇØÇ•" : "k e: ",
"Ç±Çß" : "k o: ",
"Ç™Çü" : "g a: ",
"Ç¨Ç°" : "g i: ",
"ÇÆÇ£" : "g u: ",
"ÇÆÇ·" : "gy a ",
"ÇÆÇ„" : "gy u ",
"ÇÆÇÂ" : "gy o ",
"Ç∞Ç•" : "g e: ",
"Ç≤Çß" : "g o: ",
"Ç≥Çü" : "s a: ",
"ÇµÇ°" : "sh i: ",
"Ç∑Ç£" : "s u: ",
"Ç∑Ç·" : "sh a ",
"Ç∑Ç„" : "sh u ",
"Ç∑ÇÂ" : "sh o ",
"ÇπÇ•" : "s e: ",
"ÇªÇß" : "s o: ",
"Ç¥Çü" : "z a: ",
"Ç∂Ç°" : "j i: ",
"Ç∏Ç£" : "z u: ",
"Ç∏Ç·" : "zy a ",
"Ç∏Ç„" : "zy u ",
"Ç∏ÇÂ" : "zy o ",
"Ç∫Ç•" : "z e: ",
"ÇºÇß" : "z o: ",
"ÇΩÇü" : "t a: ",
"ÇøÇ°" : "ch i: ",
"Ç¬Çü" : "ts a ",
"Ç¬Ç°" : "ts i ",
"Ç¬Ç£" : "ts u: ",
"Ç¬Ç·" : "ch a ",
"Ç¬Ç„" : "ch u ",
"Ç¬ÇÂ" : "ch o ",
"Ç¬Ç•" : "ts e ",
"Ç¬Çß" : "ts o ",
"ÇƒÇ•" : "t e: ",
"Ç∆Çß" : "t o: ",
"ÇæÇü" : "d a: ",
"Ç¿Ç°" : "j i: ",
"Ç√Ç£" : "d u: ",
"Ç√Ç·" : "zy a ",
"Ç√Ç„" : "zy u ",
"Ç√ÇÂ" : "zy o ",
"Ç≈Ç•" : "d e: ",
"Ç«Çß" : "d o: ",
"Ç»Çü" : "n a: ",
"Ç…Ç°" : "n i: ",
"Ç Ç£" : "n u: ",
"Ç Ç·" : "ny a ",
"Ç Ç„" : "ny u ",
"Ç ÇÂ" : "ny o ",
"ÇÀÇ•" : "n e: ",
"ÇÃÇß" : "n o: ",
"ÇÕÇü" : "h a: ",
"Ç–Ç°" : "h i: ",
"Ç”Ç£" : "f u: ",
"Ç”Ç·" : "hy a ",
"Ç”Ç„" : "hy u ",
"Ç”ÇÂ" : "hy o ",
"Ç÷Ç•" : "h e: ",
"ÇŸÇß" : "h o: ",
"ÇŒÇü" : "b a: ",
"Ç—Ç°" : "b i: ",
"Ç‘Ç£" : "b u: ",
"Ç”Ç·" : "hy a ",
"Ç‘Ç„" : "by u ",
"Ç”ÇÂ" : "hy o ",
"Ç◊Ç•" : "b e: ",
"Ç⁄Çß" : "b o: ",
"ÇœÇü" : "p a: ",
"Ç“Ç°" : "p i: ",
"Ç’Ç£" : "p u: ",
"Ç’Ç·" : "py a ",
"Ç’Ç„" : "py u ",
"Ç’ÇÂ" : "py o ",
"ÇÿÇ•" : "p e: ",
"Ç€Çß" : "p o: ",
"Ç‹Çü" : "m a: ",
"Ç›Ç°" : "m i: ",
"ÇﬁÇ£" : "m u: ",
"ÇﬁÇ·" : "my a ",
"ÇﬁÇ„" : "my u ",
"ÇﬁÇÂ" : "my o ",
"ÇﬂÇ•" : "m e: ",
"Ç‡Çß" : "m o: ",
"Ç‚Çü" : "y a: ",
"Ç‰Ç£" : "y u: ",
"Ç‰Ç·" : "y a: ",
"Ç‰Ç„" : "y u: ",
"Ç‰ÇÂ" : "y o: ",
"ÇÊÇß" : "y o: ",
"ÇÁÇü" : "r a: ",
"ÇËÇ°" : "r i: ",
"ÇÈÇ£" : "r u: ",
"ÇÈÇ·" : "ry a ",
"ÇÈÇ„" : "ry u ",
"ÇÈÇÂ" : "ry o ",
"ÇÍÇ•" : "r e: ",
"ÇÎÇß" : "r o: ",
"ÇÌÇü" : "w a: ",
"ÇÇß" : "o: ",
"Ç§ÅJ" : "b u ",
"Ç≈Ç°" : "d i ",
"Ç≈Ç•" : "d e: ",
"Ç≈Ç·" : "dy a ",
"Ç≈Ç„" : "dy u ",
"Ç≈ÇÂ" : "dy o ",
"ÇƒÇ°" : "t i ",
"ÇƒÇ•" : "t e: ",
"ÇƒÇ·" : "ty a ",
"ÇƒÇ„" : "ty u ",
"ÇƒÇÂ" : "ty o ",
"Ç∑Ç°" : "s i ",
"Ç∏Çü" : "z u a ",
"Ç∏Ç°" : "z i ",
"Ç∏Ç£" : "z u ",
"Ç∏Ç·" : "zy a ",
"Ç∏Ç„" : "zy u ",
"Ç∏ÇÂ" : "zy o ",
"Ç∏Ç•" : "z e ",
"Ç∏Çß" : "z o ",
"Ç´Ç·" : "ky a ",
"Ç´Ç„" : "ky u ",
"Ç´ÇÂ" : "ky o ",
"ÇµÇ·" : "sh a ",
"ÇµÇ„" : "sh u ",
"ÇµÇ•" : "sh e ",
"ÇµÇÂ" : "sh o ",
"ÇøÇ·" : "ch a ",
"ÇøÇ„" : "ch u ",
"ÇøÇ•" : "ch e ",
"ÇøÇÂ" : "ch o ",
"Ç∆Ç£" : "t u ",
"Ç∆Ç·" : "ty a ",
"Ç∆Ç„" : "ty u ",
"Ç∆ÇÂ" : "ty o ",
"Ç«Çü" : "d o a ",
"Ç«Ç£" : "d u ",
"Ç«Ç·" : "dy a ",
"Ç«Ç„" : "dy u ",
"Ç«ÇÂ" : "dy o ",
"Ç«Çß" : "d o: ",
"Ç…Ç·" : "ny a ",
"Ç…Ç„" : "ny u ",
"Ç…ÇÂ" : "ny o ",
"Ç–Ç·" : "hy a ",
"Ç–Ç„" : "hy u ",
"Ç–ÇÂ" : "hy o ",
"Ç›Ç·" : "my a ",
"Ç›Ç„" : "my u ",
"Ç›ÇÂ" : "my o ",
"ÇËÇ·" : "ry a ",
"ÇËÇ„" : "ry u ",
"ÇËÇÂ" : "ry o ",
"Ç¨Ç·" : "gy a ",
"Ç¨Ç„" : "gy u ",
"Ç¨ÇÂ" : "gy o ",
"Ç¿Ç•" : "j e ",
"Ç¿Ç·" : "j a ",
"Ç¿Ç„" : "j u ",
"Ç¿ÇÂ" : "j o ",
"Ç∂Ç•" : "j e ",
"Ç∂Ç·" : "j a ",
"Ç∂Ç„" : "j u ",
"Ç∂ÇÂ" : "j o ",
"Ç—Ç·" : "by a ",
"Ç—Ç„" : "by u ",
"Ç—ÇÂ" : "by o ",
"Ç“Ç·" : "py a ",
"Ç“Ç„" : "py u ",
"Ç“ÇÂ" : "py o ",
"Ç§Çü" : "u a ",
"Ç§Ç°" : "w i ",
"Ç§Ç•" : "w e ",
"Ç§Çß" : "w o ",
"Ç”Çü" : "f a ",
"Ç”Ç°" : "f i ",
"Ç”Ç£" : "f u ",
"Ç”Ç·" : "hy a ",
"Ç”Ç„" : "hy u ",
"Ç”ÇÂ" : "hy o ",
"Ç”Ç•" : "f e ",
"Ç”Çß" : "f o ",
"Ç†" : "a ",
"Ç¢" : "i ",
"Ç§" : "u ",
"Ç¶" : "e ",
"Ç®" : "o ",
"Ç©" : "k a ",
"Ç´" : "k i ",
"Ç≠" : "k u ",
"ÇØ" : "k e ",
"Ç±" : "k o ",
"Ç≥" : "s a ",
"Çµ" : "sh i ",
"Ç∑" : "s u ",
"Çπ" : "s e ",
"Çª" : "s o ",
"ÇΩ" : "t a ",
"Çø" : "ch i ",
"Ç¬" : "ts u ",
"Çƒ" : "t e ",
"Ç∆" : "t o ",
"Ç»" : "n a ",
"Ç…" : "n i ",
"Ç " : "n u ",
"ÇÀ" : "n e ",
"ÇÃ" : "n o ",
"ÇÕ" : "h a ",
"Ç–" : "h i ",
"Ç”" : "f u ",
"Ç÷" : "h e ",
"ÇŸ" : "h o ",
"Ç‹" : "m a ",
"Ç›" : "m i ",
"Çﬁ" : "m u ",
"Çﬂ" : "m e ",
"Ç‡" : "m o ",
"ÇÁ" : "r a ",
"ÇË" : "r i ",
"ÇÈ" : "r u ",
"ÇÍ" : "r e ",
"ÇÎ" : "r o ",
"Ç™" : "g a ",
"Ç¨" : "g i ",
"ÇÆ" : "g u ",
"Ç∞" : "g e ",
"Ç≤" : "g o ",
"Ç¥" : "z a ",
"Ç∂" : "j i ",
"Ç∏" : "z u ",
"Ç∫" : "z e ",
"Çº" : "z o ",
"Çæ" : "d a ",
"Ç¿" : "j i ",
"Ç√" : "z u ",
"Ç≈" : "d e ",
"Ç«" : "d o ",
"ÇŒ" : "b a ",
"Ç—" : "b i ",
"Ç‘" : "b u ",
"Ç◊" : "b e ",
"Ç⁄" : "b o ",
"Çœ" : "p a ",
"Ç“" : "p i ",
"Ç’" : "p u ",
"Çÿ" : "p e ",
"Ç€" : "p o ",
"Ç‚" : "y a ",
"Ç‰" : "y u ",
"ÇÊ" : "y o ",
"ÇÌ" : "w a ",
"ÇÓ" : "i ",
"ÇÔ" : "e ",
"ÇÒ" : "N ",
"Ç¡" : "q ",
"Å[" : ": ",
"Çü" : "a ",
"Ç°" : "i ",
"Ç£" : "u ",
"Ç•" : "e ",
"Çß" : "o ",
"ÇÏ" : "w a ",
"Çß" : "o ",
"Ç" : "o ",
"ÅB" : " ",
"ÅA" : " ",
"ÅH" : " ",
"," : " ",
}

if __name__ == '__main__':
    main()